3. The interface that the client server needs to provide (app to
access the game, complete the interface in accordance with the
following protocol)
After the customer completes the interface, he or she can add the interface configuration in the
BAISHUN background, and then debug and run it.
BAISHUN Server domain name：
test server：game-cn-test.jieyou.shop
Authentication and public parameters：
Two-way authentication between app server and BAISHUN server, data communication method
is HTTP POST
JSON data format (http Header adds "Content-Type", "application/json")
Signature verifies the identity of the sender of the request by calculating md5 of the random
number, AppKey, and time. AppKey must be kept strictly confidential to prevent leakage. The
request sent by BAISHUN to the app server will carry the parameters signature_nonce,
timestamp and signature. The app server calculates and compares the signature to verify the
BAISHUN identity (the reverse is also true)
Note: Signature is valid within 15 seconds. The signature_nonce is required not to be repeated
within 15 seconds (it is recommended to be globally unique) to prevent replay attacks.
Algorithm：Signature=md5（SignatureNonce+Appkey+Timestamp），The signature is hex
encoded (lowercase) and has a length of 32 bits.
signature Generate reference code：
package main
import (
"crypto/md5"
"crypto/rand"
"encoding/hex"
"fmt"
"time"
)
func GenerateSignature(signatureNonce string, appKey string, timestamp int64) string {
data := fmt.Sprintf("%s%s%d", signatureNonce, appKey, timestamp)
h := md5.New()
h.Write([]byte(data))
return hex.EncodeToString(h.Sum(nil))
}
func main() {
tempByte := make([]byte, 8)
rand.Read(tempByte)
signatureNonce := hex.EncodeToString(tempByte)
fmt.Println("nonce:", signatureNonce)
appKey := "8ddcff3a80f4189ca1c9d4d902c3c909"
timestamp := time.Now().Unix()
fmt.Println("signature:", GenerateSignature(signatureNonce, appKey, timestamp))
}
Public request parameter description：
Name Type Must write Note
signature_nonce string Yes A random string used to prevent replay attacks
and is recommended to be globally unique. The
mini game will detect an error if there is a
request with the same nonce within 15
seconds.
timestamp int Yes Timestamp. If the request timestamp exceeds
15 seconds, an error will be reported.
signature string Yes Request signature, signature algorithm see
"Authentication"
provider_name string No Requester identity description
Public return parameter description：
Name Type Note
code int Error Code
message string Error News
unique_id string Unique request ID
3.1. Obtain SSToken
BAISHUN The server side obtains the long-term token of the calling interface（ss_token）
post: /v1/api/get_sstoken
Request parameter description：
Name Type Note
app_id int64 Application ID, customer ID, added and generated by
BAISHUN background, passed to h5 front-end from
app front-end
user_id string Player ID, the player ID passed by the app front-end
to the h5 front-end
code string The temporary code passed by the app front end to
the h5 front end.
(code is a one-time parameter and is unique. After the
game server uses this parameter to obtain sstoken
from the app server, the code is no longer usable and
the app server returns an error code 1001)
Response parameter description：
Name Type Note
ss_token string Specify user_id to call the long-term token of the app server
interface.
expire_date int64 Expiration time of ss_token, timestamp, milliseconds
Example：
req:
{
"app_id":21397507,
"user_id":"id1001",
"code":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ" ,
"signature":"c62d04ebdb5100e475f45f5ebe8c64ee",
"signature_nonce":"5f0eb04d7603a9d8",
"timestamp":1682674598
}
rsp:
{
"code": 0,
"message": "succeed",
"unique_id": "1682674739807011000",
"data": {
"ss_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
"expire_date": 1671096189000
}
}
3.2 Query App User Information
The BAISHUN server sends a request to the app server to obtain the user's information
post: /v1/api/get_user_info
Request parameter description：
Name Type Must write Note
app_id int64 Yes
user_id string Yes
ss_token string Yes ss_token returned by the
/v1/api/get_sstoken interface
client_ip string Yes Can be null
game_id int Yes Game ID
Return parametersNote：
Name Type Must Write Note
user_id string Yes
user_name string Yes The user's nickname, which is
displayed in the game
user_avatar string Yes The user's avatar loading address
is displayed in the game.
balance float64 Yes User’s game currency
balance_list balance_info No User game currency information
array, for multi-currency platforms
user_type int No 1: Ordinary users, 2: Whitelist
users, 3: Blacklist users
release_cond int No This value is greater than or equal
to 0. If user_type is non-0, it will be
converted into the number of
game coins won or lost by
ordinary users.
• balance_info Note：
Name Type Must
Write
Note
name string Yes Currency Name
currency_type int Yes Currency Type definition is consistent
with the one passed to the H5 front
end
currency_amount float64 Yes Balance
Example：
req:
{
"app_id":21397507,
"user_id":"id1001",
"ss_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
"client_ip":"110.86.1.130",
"game_id":1010,
"signature":"c62d04ebdb5100e475f45f5ebe8c64ee",
"signature_nonce":"5f0eb04d7603a9d8",
"timestamp":1682674598
}
rsp:
{
"code": 0,
"message": "succeed",
"unique_id": "1603289980002643968",
"data": {
"user_id": "id1001",
"user_name": "tom",
"user_avatar": "avatar.com",
"balance":1000
}
}
3.3 ss_token Update Interface
If ss_token expires, refresh ss_token
If ss_token is not valid for a long time, provide update ss_token interface
post: /v1/api/update_sstoken
req:
{
"app_id":21397507,
"user_id":"id1001",
"ss_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
"signature":"c62d04ebdb5100e475f45f5ebe8c64ee",
"signature_nonce":"5f0eb04d7603a9d8",
"timestamp":1682674598
}
rsp:
{
"code": 0,
"message": "succeed",
"unique_id": "1603289541785956352",
"data": {
"ss_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"， //updated ss_token
"expire_date": 1671096189000 //Expiration timestamp, milliseconds
}
}
3.4 Currency Modification Interface
BAISHUN Mini games require betting and settlement, and the platform currency of the app
needs to be modified.
post: /v1/api/change_balance
Special note: For any errors, the Error Code (code) should not be 0. Error Code 0 represents
success. The Error Code for insufficient balance is: 1008.
Special note: This interface needs to be protected from concurrent processing. For a single
user, this interface may be called multiple times in one second. Modifications of player game
coins must have a lock mechanism.
diff_msg = result The game has a function to make up the order for settlement messages. When
making up the order, the order_id remains unchanged and needs to be handled correctly (the
player cannot be settled repeatedly)
Request parameter description：
Name Type Must
Write
Note
app_id int Yes
user_id string Yes
ss_token string Yes
currency_diff int64 Yes Changed game currency, negative value decreases,
positive value increases
diff_msg string Yes Reason for change，"bet"，"result", "refund", "buyin",
"buyout"
"buyin": Fish buy in，"buyout":Fish buy out，If the
fishing game is in the take-out mode
This interface is only called when buying and taking
out
game_id int Yes Game ID, mini-game ID provided by BAISHUN
game_round_id string No One game id
room_id string Yes Room ID, transparently transmitting the roomid
returned by get Config
change_time_at int64 Yes changed timestamp
order_id string Yes Order ID, unique
extend string No Expanded numeric field
msg_type string No Define the Type of the message in the extension field
currency_type int No Currency Type， app definition
Return parametersNote：
Name Type Must Write Note
currency_balance float64 Yes total remaining value
Example：
req:
{
"app_id":21397507,
"user_id":"id1001",
"ss_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
"currency_diff": -100,
"game_id":1006,
"room_id":"room_123",
"game_round_id": "rlmy01pq-cqkdd39jyrmz",
"order_id":"2R5PHkx43UQPQydCrmI71BVqXwH",
"change_time_at":1638845715,
"diff_msg":"bet",
"signature":"c62d04ebdb5100e475f45f5ebe8c64ee",
"signature_nonce":"5f0eb04d7603a9d8",
"timestamp":1682674598
}
rsp:
{
"code": 0,
"message": "succeed",
"unique_id": "1603289541785956352",
"data": {
"currency_balance": 900 //total remaining value
}
}
3.6 msg_type and extend Field specific definition
3.6.1 expanded numeric fieldNote
Games msg_type extend Description
All
Games
"" "" Real message
All
Games
robot_bet {"nickname":"Mr. Wang"} Robot betting
All
Games
robot_result {"nickname":"Mr. Wang"} Robot settlement
Rocket user_cash_out {"odds": 12000, "type":
"user_cash_out"}
User cash out（launched
）
Rocket crash_top_5 [{"user_id","","reward":5,"odds":100},...] top5（Launched）
Rocket crash_robot_result {"nickname":"Mr. Wang"，"odds":
12000}
Robot settlement
Rocket top_jackpot {"type":"top_jackpot"} Real
first prize（Launched）
Rocket robot_top_jackpot "" Robot first price
Fruit "" {"fruit":0} Betting fruit（Launched）
LUDO bet,result,skin,gift when msg_type="skin"：see 3.6.1.1
when msg_type="gift":see 3.6.1.1
bet: Participation
deduction
result: settlement reward
skin:skin purchase
gift:Gift Sent
3.6.1.1 extend Field details Note
Parameters Type Note
itemId int ID
itemType string Type
itemCount int Quantity
itemPrice int Price
currencyType int CurrencyType
roomId string RoomID
buyer string Buyer
receiver string Gift recipient
3.6.2 Fish game expanded numeric fieldNote
Example：
parameters Type Note
change_type string "bet","piggy","cdkey"
bet：Includes cannon and fish-hit rewards
piggy: Piggy bank to receive rewards
cdkey： Redeem code to receive rewards
fire_token string Bullet token, pigpy和cdkey，this field is empty
change string "bet","win","piggy","cdkey"
bet: hit
win：Rewards for hitting fish
piggy: Piggy bank to receive rewards
fish_type int Fish Type
drop_id int The boss dropped the item ID. If it is not the
boss fish, the value is 0.